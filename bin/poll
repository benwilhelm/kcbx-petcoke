#!/usr/bin/env node

var fs = require('fs')
  , cwd = process.cwd()
  , Datum = require(cwd + "/models/WeatherDatum")
  , request = require('request')
  ;

if (fs.existsSync(cwd + '/lib/_ENV.js')) {
  console.log('exists')
  require(cwd + '/lib/_ENV');
}

var owmApiUrl = "http://api.openweathermap.org/data/2.5/weather?lat=41.703292&lon=-87.5489839&APPID=" + process.env.OPEN_WEATHER_API_KEY

request.get(owmApiUrl, function(err, response, body){
  var data = JSON.parse(body);

  Datum.create({
    wind_speed     : data.wind.speed,
    wind_direction : data.wind.deg,
    wind_gusts     : data.wind.gust,
    temperature    : data.main.temp,
    humidity       : data.main.humidity,
    description    : data.weather.description,
    station        : data.name
  }, function(err, datum){
    console.log(datum);
  })
})