#!/usr/bin/env node

var cwd = process.cwd();
var env = require(cwd + '/lib/env');
var notifications = require(cwd + '/services/notifications');
var readline = require('readline');

var message = process.argv[2];

var rl = readline.createInterface({
  input  : process.stdin,
  output : process.stdout
})

if (!message || process.argv.length > 3) {
  process.stdout.write("\nUSAGE: bin/broadcast \"<message to broadcast>\"\n");
  process.exit();
}

var confirm = "\n\nYour Message:\n";
    confirm += message + "\n\n";
    confirm += "OK? [Y/n]";

rl.question(confirm, function(answer){
  if (answer !== "Y") {
    process.stdout.write("\nexiting.\n");
    rl.close();
    process.exit();
  }

  notifications.broadcast(message, function(err, rslt){
    if (err) return console.error(err);
    process.stdout.write("\nSent.\n")
    rl.close();
  });  
})